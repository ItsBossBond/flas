{% extends 'base.html' %}
{% block content %}
<section class="dash">
  <div class="dash-header">
    <div>
      <h2 class="dash-title">Your Dashboard</h2>
      <p class="dash-sub">Welcome, {{ current_user.email }}</p>
    </div>
    <div class="dash-actions">
      <a class="btn ghost" href="{{ url_for('core.index') }}#reviews">‚≠ê Reviews</a>

      <a class="btn" href="{{ url_for('core.referrals') }}" style="background:rgba(16, 185, 129, 0.15); color:#10b981; border:1px solid rgba(16, 185, 129, 0.4);">
         ü§ù Earn Money
      </a>
      <a class="btn ghost" href="{{ url_for('core.settings') }}">‚öôÔ∏è Settings</a>
    </div>
  </div>
  
  <div class="cards stats-3">
    <article class="stat">
      <span>Total Purchases</span>
      <h2 style="color:#22c55e;">${{ '%.2f'|format(total_purchases_val) }}</h2>
    </article>
      <article class="stat">
      <span>Current Balance</span>
      <h2 style="color:#3b82f6;">${{ '%.2f'|format(current_user.balance) }}</h2>
    </article>
  </div>

  <hr class="divider" style="border-color: #334155; margin: 40px 0;">

  <div style="background: rgba(59,130,246,0.1); padding: 25px; border-radius: 15px; border: 1px solid rgba(59,130,246,0.3); margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px;">
      <div>
          <h3 style="margin: 0; color: #3b82f6;">üéÅ Have a Gift Code?</h3>
          <p style="margin: 5px 0 0; color: #94a3b8;">Redeem it here to add funds instantly.</p>
      </div>
      <form action="{{ url_for('core.redeem_code') }}" method="POST" style="display: flex; gap: 10px; flex: 1; max-width: 400px;">
          <input type="text" name="gift_code" placeholder="Enter Code (e.g. GIFT100)" required style="flex: 1; padding: 10px; border-radius: 8px; border: 1px solid #334155; background: #0b1322; color: white;">
          <button type="submit" class="btn primary">Redeem</button>
      </form>
  </div>

  <div style="text-align:center; margin-bottom:30px;">
      <h2>1. Select Payment Coin</h2>
      <div class="coin-grid" style="justify-content:center; display:flex; gap:10px; flex-wrap:wrap;">
          {% for w in wallets %}
          <label class="coin-card" style="cursor:pointer;">
              <input type="radio" name="coin" value="{{ w.symbol }}" {% if loop.first %}checked{% endif %} onchange="updateUrls()" style="display:none;">
              <div class="coin-box" style="background:#334155; padding:10px 20px; border-radius:5px;">{{ w.symbol }}</div>
          </label>
          {% endfor %}
      </div>
  </div>

   <h3>2. Software Flash Senders</h3>
   <div class="grid">
      {% for t in tools %}
      <div class="card" style="border: 1px solid rgba(124,58,237,0.3);">
          <div class="badge tool" style="background:linear-gradient(135deg, #7c3aed, #06b6d4); color:white; position:absolute; top:10px; right:10px; padding:2px 8px; border-radius:4px; font-size:11px;">PRO SOFTWARE</div>
          <h3 style="margin-bottom:5px; color:#e6f1ff;">{{ t.title }}</h3>
          
          <div style="margin: 10px 0; font-size:0.9rem; color:#a5b4cf;">
             {{ t.description }}<br>
             <span style="color:#fff;">{{ t.daily_limit_text }}</span>
          </div>
          
          <div style="background:rgba(34,197,94,0.1); border:1px solid rgba(34,197,94,0.3); color:#4ade80; padding:6px; border-radius:6px; font-size:0.8rem; margin-bottom:15px;">
              ‚úÖ Tradeable & Active in all exchanges
          </div>

          <div class="price" style="font-size:1.6rem; font-weight:bold; margin:10px 0; color:#fff;">${{ t.price }}</div>
          <a href="#" data-id="{{ t.id }}" class="btn primary buy-btn" style="width:100%; text-align:center;">Buy Software</a>
      </div>
      {% endfor %}
   </div>

  <h3>3. Flash USDT Plans</h3>
  <div class="grid">
      {% for p in plans %}
      <div class="card">
          <div class="badge" style="background:#eab308; color:black; position:absolute; top:10px; right:10px; padding:2px 6px; border-radius:3px;">‚ö° FLASH</div>
          <h3>{{ p.title }}</h3>
          <p style="color:#94a3b8;">{{ p.description }}</p>
          <div class="price" style="font-size:1.5rem; font-weight:bold; margin:10px 0;">${{ p.price }}</div>
          <a href="#" data-id="{{ p.id }}" class="btn secondary buy-btn">Buy Flash</a>
      </div>
      {% endfor %}
  </div>

  <div style="text-align: center; margin: 40px 0; padding: 25px; background: rgba(59,130,246,0.1); border: 1px dashed #3b82f6; border-radius: 15px;">
      <h3 style="margin-top: 0; color: #60a5fa;">Enjoying FlashUSDT?</h3>
      <p style="color: #94a3b8; margin-bottom: 15px;">Share your experience with the community. Your feedback helps us improve.</p>
      <a href="{{ url_for('core.index') }}#reviews" class="btn" style="background: #3b82f6; color: white; border: none; padding: 10px 20px;">
        ‚úçÔ∏è Write a Review
      </a>
  </div>

  <div class="history-section" style="margin-top:30px;">
    <h3>Recent Activity</h3>
    <table class="zebra" style="width:100%; text-align:left; border-collapse:collapse; margin-top:10px;">
        <thead>
            <tr style="background:#1e293b;"><th style="padding:10px;">Item</th><th>Amount</th><th>Status</th><th>Time</th></tr>
        </thead>
        <tbody>
            {% for p in purchases %}
            <tr style="border-bottom:1px solid #334155;">
                <td style="padding:10px;">{{ p.item_name }}</td>
                <td>${{ p.amount_paid }}</td>
                <td style="color:#22c55e;">{{ p.status }}</td>
                <td>{{ p.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
            </tr>
            {% else %}
            <tr><td colspan="4" style="padding:10px; color:#64748b;">No purchases yet.</td></tr>
            {% endfor %}
        </tbody>
    </table>
  </div>
</section>

<script>
function updateUrls() {
    const coin = document.querySelector('input[name="coin"]:checked').value;
    document.querySelectorAll('.buy-btn').forEach(btn => {
        let baseUrl = "{{ url_for('core.purchase', product_id=0) }}";
        baseUrl = baseUrl.replace('/0', '/' + btn.dataset.id); 
        btn.href = baseUrl + "?coin=" + coin;
    });
}
document.addEventListener('DOMContentLoaded', updateUrls);
</script>
{% endblock %}
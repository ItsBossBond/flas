{% extends 'base.html' %}
{% block content %}
<div class="pay-card" style="max-width:500px; margin:0 auto; text-align:center;">
    <h2 style="color:#94a3b8; margin-bottom:5px;">Payment Request</h2>
    <h1 style="margin:0;">{{ item.title }}</h1>
    <div class="price-lg" style="font-size:2.5rem; color:#22c55e; font-weight:bold; margin:20px 0;">${{ item.price }}</div>
    
    <div style="background:rgba(16, 185, 129, 0.1); border:1px solid rgba(16, 185, 129, 0.3); border-radius:12px; padding:15px; margin-bottom:25px; text-align:center;">
        <p style="color:#10b981; margin:0 0 10px; font-size:0.95rem;">
            Your Available Balance: <strong style="color:white;">${{ '%.2f'|format(current_user.balance) }}</strong>
        </p>
        
        {% if current_user.balance >= item.price %}
            <form action="{{ url_for('core.pay_with_balance', product_id=item.id) }}" method="POST">
                <button type="submit" class="btn" style="background:#10b981; color:white; border:none; width:100%; padding:12px; font-weight:bold; cursor:pointer; font-size:1rem; border-radius:8px; transition:0.2s;">
                    ⚡ Pay with Balance (Instant)
                </button>
            </form>
        {% else %}
            <button disabled class="btn" style="background:#334155; color:#64748b; border:1px solid #475569; width:100%; padding:12px; cursor:not-allowed; border-radius:8px;">
                Insufficient Balance (Need ${{ '%.2f'|format(item.price - current_user.balance) }} more)
            </button>
            <p style="font-size:0.8rem; color:#64748b; margin-top:8px;">
                <a href="{{ url_for('core.referrals') }}" style="color:#10b981;">Invite friends</a> to earn more!
            </p>
        {% endif %}
    </div>

    <div style="display:flex; align-items:center; gap:10px; margin:20px 0;">
        <hr style="flex:1; border:0; border-top:1px solid #334155;">
        <span style="color:#64748b; font-size:0.8rem; font-weight:bold;">OR PAY WITH CRYPTO</span>
        <hr style="flex:1; border:0; border-top:1px solid #334155;">
    </div>
    
    <div style="background:#0f172a; padding:15px; border-radius:10px; border:1px solid #334155;">
        <p style="margin-top:0;">Pay via: <strong style="color:#3b82f6;">{{ coin }}</strong></p>
        
        <div style="background:white; padding:10px; display:inline-block; border-radius:10px; margin-bottom:15px;">
            {% if wallet.qr_image %}
                <img src="{{ url_for('static', filename='qr/' + wallet.folder + '/' + wallet.qr_image) }}" 
                     alt="QR Code" style="width:180px; height:180px; display:block;"
                     onerror="this.src='https://placehold.co/180?text=No+QR';">
            {% else %}
                <img src="https://placehold.co/180?text=No+QR" 
                     alt="QR Code" style="width:180px; height:180px; display:block;">
            {% endif %}
        </div>
        <p style="font-size:0.9rem; color:#94a3b8; margin-bottom:5px;">Send exact amount to:</p>
        <div class="addr-box" style="background:#1e293b; padding:10px; font-family:monospace; word-break:break-all; border-radius:5px;">{{ wallet.address }}</div>
        <button onclick="navigator.clipboard.writeText('{{ wallet.address }}'); alert('Copied!');" class="btn secondary" style="margin-top:10px;">Copy Address</button>
    </div>

    <div style="margin-top:20px;">
        <a href="{{ url_for('core.verify_payment', product_id=item.id, coin=coin) }}" class="btn primary" style="width:100%; display:block; padding:15px;">✅ I Have Sent Payment</a>
        <br>
        <a href="{{ url_for('core.dashboard') }}" class="btn ghost">Cancel</a>
    </div>
</div>
{% endblock %}